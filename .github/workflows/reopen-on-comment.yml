name: Reopen issue when someone comments "reopen"

on:
  issue_comment:
    types: [created, edited]

permissions:
  issues: write
  pull-requests: write

jobs:
  reopen:
    runs-on: ubuntu-latest
    steps:
      - name: Reopen when comment contains "reopen"
        uses: actions/github-script@v7
        with:
          script: |
            const body = (context.payload.comment?.body || "").trim();

            // Match "reopen" som et selvstændigt ord (case-insensitive)
            const matches = /\breopen\b/i.test(body);
            if (!matches) {
              core.info('No "reopen" keyword found. Exiting.');
              return;
            }

            const issue = context.payload.issue;
            if (!issue) {
              core.info("No issue payload. Exiting.");
              return;
            }

            if (issue.state !== "closed") {
              core.info("Issue is not closed. Nothing to do.");
              return;
            }

            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const number = issue.number;

            // Hvis det er en PR (issue_comment gælder også PR's), brug pulls.update
            if (issue.pull_request) {
              core.info(`Reopening PR #${number}...`);
              await github.rest.pulls.update({
                owner,
                repo,
                pull_number: number,
                state: "open",
              });
              return;
            }

            // Almindeligt issue
            core.info(`Reopening issue #${number}...`);
            await github.rest.issues.update({
              owner,
              repo,
              issue_number: number,
              state: "open",
            });